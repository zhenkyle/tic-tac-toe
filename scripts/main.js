"use strict";$(document).ready(function(){function e(e,t,o,a,i,l){e.beginPath(),e.moveTo(t,o+l),e.lineTo(t,o+i-l),e.arcTo(t,o+i,t+l,o+i,l),e.lineTo(t+a-l,o+i),e.arcTo(t+a,o+i,t+a,o+i-l,l),e.lineTo(t+a,o+l),e.arcTo(t+a,o,t+a-l,o,l),e.lineTo(t+l,o),e.arcTo(t,o,t,o+l,l),e.stroke()}function t(){var t=document.getElementById("background-layer");if(t.getContext){var o=t.getContext("2d");e(o,1,1,448,448,15),o.beginPath(),o.moveTo(150,0),o.lineTo(150,450),o.moveTo(300,0),o.lineTo(300,450),o.moveTo(0,150),o.lineTo(450,150),o.moveTo(0,300),o.lineTo(450,300),o.stroke()}}function o(e){var t=[e.slice(0,3),e.slice(3,6),e.slice(6,9),[e[0],e[3],e[6]],[e[1],e[4],e[7]],[e[2],e[5],e[8]],[e[0],e[4],e[8]],[e[2],e[4],e[6]]].map(function(e){return e[0]+e[1]+e[2]});return t.includes(3)?1:t.includes(30)?10:e.includes(0)?-1:0}function a(e){var t=[[0,2],[3,5],[6,8],[0,6],[1,7],[2,8],[0,8],[2,6]],o=[e.slice(0,3),e.slice(3,6),e.slice(6,9),[e[0],e[3],e[6]],[e[1],e[4],e[7]],[e[2],e[5],e[8]],[e[0],e[4],e[8]],[e[2],e[4],e[6]]].map(function(e){return e[0]+e[1]+e[2]});return o.includes(3)?t[o.indexOf(3)]:o.includes(30)?t[o.indexOf(30)]:(e.includes(0),null)}function i(e,t,a){e=Array.from(e),e[t]=a;var l,n=o(e),r=[],s=1===a?10:1,c=!0;if(n!==-1)return n;for(e.forEach(function(e,t){0===e&&r.push(t)}),l=0;l<r.length;l+=1){if(n=i(e,r[l],s),n===s)return n;0===n&&(c=!1)}return c===!0?a:0}var l=Backbone.Model.extend({defaults:{board:[0,0,0,0,0,0,0,0,0]}}),n=Backbone.View.extend({el:$("#game-layer"),events:{click:"userPlay","touchstart ":"userPlay"},initialize:function(){this.myModal=$("#myModal"),this.listenTo(this.model,"change",this.render)},render:function(){var e=this.el,t=e.getContext("2d"),i=_.clone(this.model.get("board"));t.clearRect(0,0,e.width,e.height),i.forEach(function(e,o){0!==e&&(t.save(),t.translate(150*(o%3),150*(Math.floor(o/3)%3)),1===e?(t.beginPath(),t.moveTo(25,25),t.lineTo(125,125),t.moveTo(125,25),t.lineTo(25,125),t.stroke()):10===e&&(t.beginPath(),t.arc(75,75,50,0,2*Math.PI,!0),t.moveTo(110,75),t.arc(75,75,35,0,Math.PI,!1),t.moveTo(65,65),t.arc(60,65,5,0,2*Math.PI,!0),t.moveTo(95,65),t.arc(90,65,5,0,2*Math.PI,!0),t.stroke()),t.restore())});var l=o(i);if(l!=-1){if(0!==l){var n=a(i),s=n[0],c=n[1];t.save(),t.setLineDash([4,4]),t.beginPath(),t.moveTo(75+150*(s%3),75+150*(Math.floor(s/3)%3)),t.lineTo(75+150*(c%3),75+150*(Math.floor(c/3)%3)),t.stroke(),t.restore()}}else r.lastMove===r.playerSide&&this.computerPlay()},userPlay:function(e){var t=this.$el.offset();switch(e.type){case"click":var o=e.pageX-t.left,a=e.pageY-t.top;break;case"touchstart":e.preventDefault();var o=e.changedTouches[0].pageX-t.left,a=e.changedTouches[0].pageY-t.top}var i=Math.floor(o/150)+3*Math.floor(a/150),l=_.clone(this.model.get("board"));0===l[i]&&this.play(i,r.playerSide)},computerPlay:function(){var e=_.clone(this.model.get("board")),t=e.reduce(function(e,t,o,a){return null!=e?e:0!=t?e:i(a,o,r.computerSide)===r.computerSide?o:e},null);null===t&&(t=e.reduce(function(e,t,o,a){return null!=e?e:0!=t?e:0===i(a,o,r.computerSide)?o:e},null)),null===t&&(t=e.indexOf(0)),this.play(t,r.computerSide)},play:function(e,t){var o=_.clone(this.model.get("board"));o[e]=t,r.lastMove=t,this.model.set("board",o)}}),r={playerSide:1,computerSide:10,lastMove:null},s=Backbone.View.extend({el:$("#ui-layer"),events:{touchstart:"hideMe",click:"hideMe"},hideMe:function(e){"touchstart"===e.type&&e.preventDefault(),this.$el.hide(),this.swapSide(),this.startNewGame()},initialize:function(){this.listenTo(this.model,"change",this.render),this.$el.hide()},render:function(){var e=_.clone(this.model.get("board")),t=o(e);t!=-1&&(t===r.playerSide&&this.$("#ui-layer-inner").html("<h1><small>You Win!</small></h1><h4><small>click to change side and play again.</small></h4>"),t===r.computerSide&&this.$("#ui-layer-inner").html("<h1> <small>You Lose!</small><h1><h4><small>click to change side and play again.</small></h4>"),0===t&&this.$("#ui-layer-inner").html("<h1> <small>Draw!</small><h1><h4><small>click to change side and play again.</small></h4>"),this.$el.show())},swapSide:function(){r.playerSide=1===r.playerSide?10:1,r.computerSide=1===r.playerSide?10:1},startNewGame:function(){if(r.lastMove=null,this.model.set("board",[0,0,0,0,0,0,0,0,0]),1===r.computerSide){var e=Math.floor(9*Math.random());this.play(e,r.computerSide)}},play:function(e,t){var o=_.clone(this.model.get("board"));o[e]=t,r.lastMove=t,this.model.set("board",o)}}),c=Backbone.View.extend({el:$("#myModal"),events:{"hidden.bs.modal":"chooseSide"},initialize:function(){this.$el.modal()},chooseSide:function(){r.playerSide=parseInt(this.$("input[type='radio']:checked").val()),r.computerSide=1===r.playerSide?10:1,this.startNewGame()},startNewGame:function(){if(r.lastMove=null,this.model.set("board",[0,0,0,0,0,0,0,0,0]),1===r.computerSide){var e=Math.floor(9*Math.random());this.play(e,r.computerSide)}},play:function(e,t){var o=_.clone(this.model.get("board"));o[e]=t,r.lastMove=t,this.model.set("board",o)}});t();var d=new l;new n({model:d}),new s({model:d}),new c({model:d})});